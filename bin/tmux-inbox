#!/bin/bash

# curl the google feed, print email titles, word count lines and convert to
# integer, then subtract 1 for header title and display if > 0

ATOM_RESULT=`curl -u $GMAIL_USER:$GMAIL_PASS --silent "https://mail.google.com/mail/feed/atom"  | perl -ne 'print "$2\n" if /<(title)>(.*)<\/\1>/;' | wc -l | bc`
let UNREAD_COUNTER=$ATOM_RESULT-1 

if [ "$UNREAD_COUNTER" -gt "0" ]; then
  echo "#[fg=yellow]$UNREAD_COUNTER"
else
  echo "0"
fi
